!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=[{value:"",text:"Type",selected:!0},{value:"tv",text:"TV"},{value:"movie",text:"Movie"},{value:"ova",text:"OVA"},{value:"special",text:"Special"},{value:"ona",text:"ONA"},{value:"music",text:"Music"},{value:"cm",text:"CM"},{value:"pv",text:"PV"},{value:"tv_special",text:"TV Special"}],t=[{value:"",text:"Order By",selected:!0},{value:"mal_id",text:"MAL ID"},{value:"title",text:"Title"},{value:"start_date",text:"Start Date"},{value:"end_date",text:"End Date"},{value:"episodes",text:"Episodes"},{value:"score",text:"Score"},{value:"scored_by",text:"Scored By"},{value:"rank",text:"Rank"},{value:"popularity",text:"Popularity"},{value:"members",text:"Members"},{value:"favorites",text:"Favorites"}],a=[{value:"",text:"Ratings",selected:!0},{value:"g",text:"G - All Ages"},{value:"pg",text:"PG - Children"},{value:"pg13",text:"PG - 13 - Teens 13 or Older"},{value:"r17",text:"R - 17+ (Violence & Profanity)"},{value:"r",text:"R+ - Mild Nudity"},{value:"rx",text:"Rx - Hentai"}],n="https://api.jikan.moe/v4",r=async()=>{const e={genres:`${n}/genres/anime?filter=genres`,explicit_genres:`${n}/genres/anime?filter=explicit_genres`,themes:`${n}/genres/anime?filter=themes`};try{const t=Object.entries(e).map(async([e,t])=>{const a=await fetch(t);if(!a.ok)throw new Error(`Failed to fetch ${e}`);return[e,(await a.json()).data]}),a=await Promise.all(t),n=Object.fromEntries(a);return n.demographics=[{mal_id:43,name:"Josei",url:"https://myanimelist.net/anime/genre/43/Josei",count:160},{mal_id:15,name:"Kids",url:"https://myanimelist.net/anime/genre/15/Kids",count:6980},{mal_id:42,name:"Seinen",url:"https://myanimelist.net/anime/genre/42/Seinen",count:1127},{mal_id:25,name:"Shoujo",url:"https://myanimelist.net/anime/genre/25/Shoujo",count:519},{mal_id:27,name:"Shounen",url:"https://myanimelist.net/anime/genre/27/Shounen",count:2163}],n}catch(t){return console.error("Error when fetching anime genres:",t),null}},s=async(e,t)=>{try{const a=await(async(e,t=1500,a=3)=>{let n=0;for(;n<a;)try{const a=await fetch(e);if(a.ok)return a;if(429===a.status){await new Promise(e=>setTimeout(e,t)),n++;continue}throw new Error(`HTTP Error ${a.status}`)}catch(r){if(console.error(`Fetch error: ${r.message}`),n>=a-1)throw r;await new Promise(e=>setTimeout(e,t)),n++}})(`${n}/anime?limit=25&page=${e}&${t}`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const r=await a.json();return{pagination:r.pagination,data:r.data}}catch(a){throw console.error("Error when fetching anime:",a.message),a}},i=e=>e?(JSON.parse(localStorage.getItem("animes"))||[]).map(e=>e.id):JSON.parse(localStorage.getItem("animes"))||[],o=async(e,t=!1,a=1)=>{const n=document.querySelector("#animeCardContainer"),r=await s(a,e),c=i(!0),l=r.data.filter(e=>!(t&&c.includes(e.mal_id))).map(e=>(c.includes(e.mal_id)&&(e.saved=!0),(e=>{const t=[...e.genres.map(e=>`<span class="badge">${e.name}</span>`),...e.themes.map(e=>`<span class="badge">${e.name}</span>`),...e.explicit_genres.map(e=>`<span class="badge badge-not">${e.name}</span>`),...e.demographics.map(e=>`<span class="badge badge-yes">${e.name}</span>`)].join("");return`\n        <fieldset class="card-fieldset" style="padding: 8px">\n            <legend><span>‚òÜ ${e.score}</span> | <span>‚ò∫ ${a=e.members,a>=1e9?(a/1e9).toFixed(1).replace(/\.0$/,"")+"B":a>=1e6?(a/1e6).toFixed(1).replace(/\.0$/,"")+"M":a>=1e3?(a/1e3).toFixed(1).replace(/\.0$/,"")+"K":a}</span></legend>\n            <header>\n                <hgroup>\n                    <h3 title="${e.title}">${e.title}</h3>\n                    <h5 title="${e.title_english||""}">${e.title_english||"-"}</h5>\n                </hgroup>\n                <button class="btn save ${e.saved?"saved":""}" data-id="${e.mal_id}" type="button">üè∑</button>\n            </header>\n            <article>\n                <figure>\n                    <img\n                        src="${e.images.webp.image_url}"\n                        alt="${e.title} Poster Image"\n                        loading="lazy"\n                    />\n                    <figcaption>${e.title} Poster Image</figcaption>\n                </figure>\n                <div class="info">\n                    <p>${e.synopsis}</p>\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td>Type</td>\n                                <td>: ${e.type}</td>\n                            </tr>\n                            <tr>\n                                <td>Episodes</td>\n                                <td>: ${e.episodes} (${e.duration.replace(" per ","/")})</td>\n                            </tr>\n                            <tr>\n                                <td>Status</td>\n                                <td>: ${e.status}</td>\n                            </tr>\n                            <tr>\n                                <td>Season</td>\n                                <td>: <time>${e.year}/${e.season}</time></td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </article>\n            <footer class="badge-container">${t}</footer>\n        </fieldset>\n    `;var a})(e))).join("");n.innerHTML=l,((e,t,a)=>{const n=document.querySelector("#pagination"),r=n.querySelector("#next"),s=n.querySelector("#prev");n.querySelector("#current").textContent=e.current_page,r.setAttribute("data-query",t),s.setAttribute("data-query",t),1===e.current_page?s.setAttribute("disabled",!0):s.removeAttribute("disabled"),e.has_next_page?r.removeAttribute("disabled"):r.setAttribute("disabled",!0),n.style.display="flex",r.addEventListener("click",()=>{o(r.getAttribute("data-query"),a,e.current_page+1)}),s.addEventListener("click",()=>{o(s.getAttribute("data-query"),a,e.current_page-1)})})(r.pagination,e,t)},c=(e,t)=>{const a=document.querySelector(e).querySelector(".checkbox-group");t.forEach(({mal_id:t,name:n})=>{const r=document.createElement("label");r.style="display:flex;gap:4px;";const s=document.createElement("input");s.type="checkbox",s.value=t,s.setAttribute("data-name",n),s.setAttribute("data-group",e),s.setAttribute("data-state","none"),s.style.display="none";const i=document.createElement("div");i.className="checkbox3-container",r.append(s,i,n),a.appendChild(r)})},l=(e,t)=>{const a=document.querySelector(e);t.forEach(({text:e,value:t,selected:n=!1})=>{a.add(new Option(e,t,!1,n))})},d=async()=>{const e=document.querySelector("#sidebarFormSearch"),t=e.querySelector("#modal-genres"),a=e.querySelector("#open-modal-genres"),n=t.querySelector("#close-modal-genres"),s=t.querySelector("#clear-chosed-genres"),{genres:i,explicit_genres:o,themes:l,demographics:d}=await r();c("#genres",i),c("#explicit_genres",o),c("#themes",l),c("#demographics",d),document.querySelector("#modal-genres").addEventListener("click",function(e){const t=e.target.closest(".checkbox3-container");if(!t)return;const a=t.previousElementSibling;let n=a.getAttribute("data-state");if(t.innerHTML="","none"===n){a.setAttribute("data-state","checked"),a.checked=!0,t.innerHTML="‚úì",t.className="checkbox3-container checked";const e=document.querySelector(`${a.getAttribute("data-group")}-contain`).querySelector(".badge-container"),n=document.createElement("div");n.className="badge badge-yes",n.setAttribute("data-mal-id",a.value),n.textContent=a.getAttribute("data-name"),e.appendChild(n)}"checked"===n&&(a.setAttribute("data-state","crossed"),a.checked=!1,t.innerHTML="‚úó",t.className="checkbox3-container crossed",document.querySelector(`${a.getAttribute("data-group")}-contain`).querySelector(".badge-container").querySelector(`div[data-mal-id="${a.value}"]`).className="badge badge-not"),"crossed"===n&&(a.setAttribute("data-state","none"),a.checked=!1,t.innerHTML="",t.className="checkbox3-container",document.querySelector(`${a.getAttribute("data-group")}-contain`).querySelector(".badge-container").querySelector(`div[data-mal-id="${a.value}"]`).remove())}),a.addEventListener("click",()=>{t.style.display="flex"}),n.addEventListener("click",()=>{t.style.display="none"}),s.addEventListener("click",()=>{const a=t.querySelectorAll(".checkbox3-container");e.querySelectorAll(".badge").forEach(e=>e.remove()),a.forEach(e=>{const t=e.previousElementSibling;t.setAttribute("data-state","none"),t.checked=!1,e.innerHTML="",e.className="checkbox3-container"})}),a.removeAttribute("disabled"),a.className="btn"},u=()=>{const e=document.querySelector("#sidebarFormSearch");e.addEventListener("submit",t=>{t.preventDefault();const a=e.querySelector('input[name="hide_saved"]:checked'),n=new FormData(e);["anime_sort","anime_status"].forEach(t=>{const a=e.querySelector(`input[name="${t}"]:checked`);a&&n.set(t,a.value)}),n.set("anime_sfw",e.anime_sfw.checked),n.set("genres",[...document.querySelectorAll('[data-state="checked"]')].map(e=>e.value)),n.set("genres_exclude",[...document.querySelectorAll('[data-state="crossed"]')].map(e=>e.value));const r={anime_search:"q",anime_type:"type",anime_order:"order_by",anime_rating:"rating",anime_sort:"sort",anime_status:"status",anime_min_score:"min_score",anime_max_score:"max_score",anime_start_date:"start_date",anime_end_date:"end_date",anime_sfw:"sfw",genres:"genres",genres_exclude:"genres_exclude"};for(const[e,i]of Object.entries(r))if(n.has(e)){const t=n.get(e);n.delete(e),"sfw"===i&&"true"===t&&n.set(i,""),"sfw"!==i&&t.length>1&&n.set(i,t)}n.delete("hide_saved");const s=new URLSearchParams(n).toString();o(s,Boolean(a))})};document.addEventListener("DOMContentLoaded",async()=>{document.querySelector("#sidebarFormSearch")&&(l("#anime_type",e),l("#anime_order",t),l("#anime_rating",a)),d(),u(),setTimeout(()=>{o("")},1500),document.querySelector("#animeCardContainer").addEventListener("click",e=>{const t=e.target.closest(".save");if(!t)return;const a=Number(t.getAttribute("data-id")),n=t.parentElement.querySelector("h3").title;t.classList.contains("saved")?((e=>{const t=JSON.parse(localStorage.getItem("animes"))||[];localStorage.setItem("animes",JSON.stringify(t.filter(t=>t.id!==e)))})(a),(e=>{document.querySelector("#listSavedAnime").querySelector(`li[data-id="${e}"]`).remove()})(a)):(((e,t="")=>{const a=JSON.parse(localStorage.getItem("animes"))||[];a.push({id:e,title:t}),localStorage.setItem("animes",JSON.stringify(a))})(a,n),((e,t)=>{const a=document.querySelector("#listSavedAnime"),n=document.createElement("li");n.setAttribute("data-id",e),n.textContent=t,a.appendChild(n)})(a,n)),t.classList.toggle("saved")}),(()=>{const e=document.querySelector("#listSavedAnime"),t=i().map(e=>`<li data-id="${e.id}">${e.title}</li>`).join("");e.innerHTML=t})()});
